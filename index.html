<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vehicle Visual Check</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
/* QR hidden until generated */
#qrWrapper {
  display: none;
  text-align: center;
  margin-top: 20px;
}

/* Fullscreen QR overlay */
#qrFullscreen {
  display: none;
  position: fixed;
  inset: 0;
  background: white;
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

#qrFullscreen small {
  margin-top: 12px;
  opacity: 0.7;
}
</style>
</head>

<body>
<div class="container">

<h2>Vehicle Visual Check</h2>

<label>Registration
  <input id="reg" maxlength="8" style="text-transform:uppercase">
</label>

<label>MOT Expiry Date
  <input type="date" id="mot">
</label>

<h3>Windscreen & Wipers</h3>
<label>Windscreen
  <select id="windscreen">
    <option value="W">No issues seen</option>
    <option value="I">Chip / crack observed</option>
  </select>
</label>

<label>Wipers
  <select id="wipers">
    <option value="W">Working</option>
    <option value="I">Worn / damaged</option>
  </select>
</label>

<h3>Tyre Tread Depth (mm)</h3>
<div class="grid">
  <label>Driver Front <input type="number" step="0.1" id="td_df"></label>
  <label>Driver Rear <input type="number" step="0.1" id="td_dr"></label>
  <label>Passenger Front <input type="number" step="0.1" id="td_pf"></label>
  <label>Passenger Rear <input type="number" step="0.1" id="td_pr"></label>
</div>

<h3>Lights – Driver Side</h3>
<div class="grid">
  <label>Front <select id="d_fl"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Rear <select id="d_rl"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Brake <select id="d_br"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Indicator Front <select id="d_if"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Indicator Rear <select id="d_ir"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Side Repeater <select id="d_is"><option value="W">Working</option><option value="I">Issue</option></select></label>
</div>

<h3>Lights – Passenger Side</h3>
<div class="grid">
  <label>Front <select id="p_fl"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Rear <select id="p_rl"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Brake <select id="p_br"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Indicator Front <select id="p_if"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Indicator Rear <select id="p_ir"><option value="W">Working</option><option value="I">Issue</option></select></label>
  <label>Side Repeater <select id="p_is"><option value="W">Working</option><option value="I">Issue</option></select></label>
</div>

<h3>Additional / Extra Lighting Observations</h3>
<label>
  <textarea id="lightNotes" rows="3" placeholder="e.g. DRL strip partially out, light bar not working, aftermarket lighting noted"></textarea>
</label>

<button onclick="generate()">Generate QR Code</button>

<!-- QR only appears AFTER generation -->
<div id="qrWrapper">
  <div id="qrcode" onclick="openFullscreenQR()"></div>
  <small>Tap QR to enlarge for scanning</small>
</div>

<small>Visual check only. Not an MOT or safety guarantee.</small>

</div>

<!-- Fullscreen QR -->
<div id="qrFullscreen" onclick="closeFullscreenQR()">
  <div id="qrBig"></div>
  <small>Increase screen brightness for best scanning</small>
</div>

<script>
let wakeLock = null;

async function requestWakeLock() {
  try {
    wakeLock = await navigator.wakeLock.request("screen");
  } catch {}
}

function generate() {
  reg.value = reg.value.toUpperCase();

  const data = {
    r: reg.value,
    m: mot.value,
    w: windscreen.value,
    wp: wipers.value,
    n: lightNotes.value,
    t: {
      df: parseFloat(td_df.value) || null,
      dr: parseFloat(td_dr.value) || null,
      pf: parseFloat(td_pf.value) || null,
      pr: parseFloat(td_pr.value) || null
    },
    l: {
      d:{fl:d_fl.value,rl:d_rl.value,br:d_br.value,if:d_if.value,ir:d_ir.value,is:d_is.value},
      p:{fl:p_fl.value,rl:p_rl.value,br:p_br.value,if:p_if.value,ir:p_ir.value,is:p_is.value}
    }
  };

  const encoded = encodeURIComponent(JSON.stringify(data));
  const url = "https://ivanmjwarburton.github.io/Car.Check/report.html?d=" + encoded;

  document.getElementById("qrWrapper").style.display = "block";
  document.getElementById("qrcode").innerHTML = "";

  new QRCode(document.getElementById("qrcode"), {
    text: url,
    width: 180,
    height: 180,
    correctLevel: QRCode.CorrectLevel.M
  });
}

function openFullscreenQR() {
  const fs = document.getElementById("qrFullscreen");
  const big = document.getElementById("qrBig");
  big.innerHTML = document.getElementById("qrcode").innerHTML;
  fs.style.display = "flex";
  document.documentElement.requestFullscreen?.();
  requestWakeLock();
}

function closeFullscreenQR() {
  document.exitFullscreen?.();
  document.getElementById("qrFullscreen").style.display = "none";
  wakeLock?.release?.();
}
</script>

</body>
</html>
