<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vehicle Check</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
</head>

<body>
<div class="container">

<h2>Vehicle Check</h2>

<label>Registration</label>
<input id="reg" maxlength="8" placeholder="AB12CDE" oninput="this.value=this.value.toUpperCase()">

<label>MOT Expiry Date</label>
<input id="mot" type="date">

<h3>Windscreen Damage Mapping</h3>
<div id="windscreen-container">
  <img id="windscreen-img" src="windscreen.jpg" alt="Windscreen">
  <div id="marker-layer"></div>
</div>
<p class="hint">Tap the windscreen to mark a chip or crack</p>

<h3>Windscreen & Wipers</h3>
<select id="windscreen">
  <option value="N">No issues found</option>
  <option value="W">Issue observed</option>
</select>

<select id="wipers">
  <option value="N">No issues found</option>
  <option value="W">Issue observed</option>
</select>

<h3>Tyre Tread Depth (mm)</h3>
<div class="grid">
  <input id="df" placeholder="Driver Front">
  <input id="dr" placeholder="Driver Rear">
  <input id="pf" placeholder="Passenger Front">
  <input id="pr" placeholder="Passenger Rear">
</div>

<h3>Lights</h3>
<div class="grid">
  <label>Driver Front</label><select id="d_fl"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Driver Rear</label><select id="d_rl"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Driver Brake</label><select id="d_br"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Driver Indicator Front</label><select id="d_if"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Driver Indicator Rear</label><select id="d_ir"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Driver Repeater</label><select id="d_is"><option value="W">Working</option><option value="F">Issue</option></select>

  <label>Passenger Front</label><select id="p_fl"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Passenger Rear</label><select id="p_rl"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Passenger Brake</label><select id="p_br"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Passenger Indicator Front</label><select id="p_if"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Passenger Indicator Rear</label><select id="p_ir"><option value="W">Working</option><option value="F">Issue</option></select>
  <label>Passenger Repeater</label><select id="p_is"><option value="W">Working</option><option value="F">Issue</option></select>
</div>

<h3>Additional / Extra Lighting Observations</h3>
<textarea id="notes"></textarea>

<button onclick="generate()">Generate QR</button>

<div id="qr-wrap" style="display:none">
  <div id="qr"></div>
</div>

</div>

<script>
const wsMarks = [];
const img = document.getElementById("windscreen-img");
const layer = document.getElementById("marker-layer");

img.onclick = e => {
  const r = img.getBoundingClientRect();
  const x = ((e.clientX - r.left) / r.width) * 100;
  const y = ((e.clientY - r.top) / r.height) * 100;
  const type = confirm("OK = Chip\nCancel = Crack") ? "chip" : "crack";
  wsMarks.push({ x: Math.round(x), y: Math.round(y), t: type });

  const m = document.createElement("div");
  m.className = `ws-marker ws-${type}`;
  m.style.left = `${x}%`;
  m.style.top = `${y}%`;
  layer.appendChild(m);
};

function generate() {
  const data = {
    r: reg.value,
    m: mot.value,
    d: new Date().toISOString(),
    ws: wsMarks,
    w: windscreen.value,
    wp: wipers.value,
    t: {
      df: df.value, dr: dr.value, pf: pf.value, pr: pr.value
    },
    l: {
      d:{fl:d_fl.value,rl:d_rl.value,br:d_br.value,if:d_if.value,ir:d_ir.value,is:d_is.value},
      p:{fl:p_fl.value,rl:p_rl.value,br:p_br.value,if:p_if.value,ir:p_ir.value,is:p_is.value}
    },
    n: notes.value
  };

  const encoded = encodeURIComponent(JSON.stringify(data));
  const url = `report.html?d=${encoded}`;

  qr.innerHTML = "";
  new QRCode(qr, { text:url, width:200, height:200 });
  document.getElementById("qr-wrap").style.display = "block";
}
</script>

</body>
</html>
