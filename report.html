<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vehicle Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container">
<h2>Vehicle Check Report</h2>
<div id="out"></div>
</div>

<script>
const d = JSON.parse(decodeURIComponent(new URLSearchParams(location.search).get("d")));

function daysLeft(date){
  const diff = (new Date(date) - new Date()) / 86400000;
  return Math.floor(diff);
}

let issues = 0;

function tyre(v){
  if(!v) return "Not checked";
  if(v<1.6){ issues++; return `<span class="bad">${v}mm Illegal</span>`;}
  if(v<3){ issues++; return `<span class="warn">${v}mm Low</span>`;}
  return `<span class="good">${v}mm Good</span>`;
}

function badge(v){
  if(v==="F"){ issues++; return `<span class="warn">Issue</span>`;}
  return `<span class="good">OK</span>`;
}

let html = `
<p><strong>Registration:</strong> ${d.r}</p>
<p><strong>Check Date:</strong> ${new Date(d.d).toLocaleString()}</p>
<p><strong>MOT:</strong> ${d.m} (${daysLeft(d.m)} days)</p>

<h3>Overall Status</h3>
<p class="${issues? 'warn':'good'}">${issues} issue(s) observed</p>

<h3>Windscreen Damage</h3>
<div id="windscreen-report">
<img src="windscreen.jpg">
<div id="ws-layer"></div>
</div>

<h3>Tyres</h3>
<ul>
<li>Driver Front: ${tyre(d.t.df)}</li>
<li>Driver Rear: ${tyre(d.t.dr)}</li>
<li>Passenger Front: ${tyre(d.t.pf)}</li>
<li>Passenger Rear: ${tyre(d.t.pr)}</li>
</ul>

<h3>Lights</h3>
<ul>
<li>Driver Front: ${badge(d.l.d.fl)}</li>
<li>Driver Rear: ${badge(d.l.d.rl)}</li>
<li>Driver Brake: ${badge(d.l.d.br)}</li>
<li>Passenger Front: ${badge(d.l.p.fl)}</li>
<li>Passenger Rear: ${badge(d.l.p.rl)}</li>
<li>Passenger Brake: ${badge(d.l.p.br)}</li>
</ul>

<h3>Notes</h3>
<p>${d.n||"None"}</p>

<small>Visual check only â€“ not an MOT or safety guarantee.</small>
`;

out.innerHTML = html;

const layer = document.getElementById("ws-layer");
(d.ws||[]).forEach(m=>{
  const el=document.createElement("div");
  el.className=`ws-marker ws-${m.t}`;
  el.style.left=m.x+"%";
  el.style.top=m.y+"%";
  layer.appendChild(el);
});
</script>
</body>
</html>
